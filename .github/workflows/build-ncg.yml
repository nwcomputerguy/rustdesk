name: Package NCG Remote Access

on:
  workflow_dispatch:

jobs:
  package:
    runs-on: windows-latest
    
    steps:
    - name: Download RustDesk
      run: |
        curl -L -o rustdesk.exe https://github.com/rustdesk/rustdesk/releases/download/1.4.0/rustdesk-1.4.0-x86_64.exe
      shell: cmd
    
    - name: Create package
      run: |
        mkdir NCG-Remote
        copy rustdesk.exe NCG-Remote\NCG-Remote-Access.exe
      shell: cmd
    
    - name: Create config
      run: |
        echo rendezvous_server = 'rust.northwoodscomputerguy.com:21116' > NCG-Remote\RustDesk2.toml
        echo nat_type = 1 >> NCG-Remote\RustDesk2.toml
        echo serial = 0 >> NCG-Remote\RustDesk2.toml
        echo. >> NCG-Remote\RustDesk2.toml
        echo [options] >> NCG-Remote\RustDesk2.toml
        echo custom-rendezvous-server = 'rust.northwoodscomputerguy.com:21116' >> NCG-Remote\RustDesk2.toml
        echo key = 'sjVK2P8Cik7MW4v6sn1FhCN5RdRAK1BpqXlSDraF0qY=' >> NCG-Remote\RustDesk2.toml
        echo relay-server = 'rust.northwoodscomputerguy.com:21117' >> NCG-Remote\RustDesk2.toml
        echo api-server = '' >> NCG-Remote\RustDesk2.toml
      shell: cmd
    
    - name: Create launcher
      run: |
        echo @echo off > NCG-Remote\Start-NCG-Remote.bat
        echo title NCG Remote Access >> NCG-Remote\Start-NCG-Remote.bat
        echo echo Starting NCG Remote Access... >> NCG-Remote\Start-NCG-Remote.bat
        echo start "" NCG-Remote-Access.exe >> NCG-Remote\Start-NCG-Remote.bat
        echo echo. >> NCG-Remote\Start-NCG-Remote.bat
        echo echo Your ID will appear in the main window >> NCG-Remote\Start-NCG-Remote.bat
        echo pause >> NCG-Remote\Start-NCG-Remote.bat
      shell: cmd
    
    - name: Create ZIP
      run: |
        powershell Compress-Archive -Path NCG-Remote\* -DestinationPath NCG-Remote-Portable.zip
      shell: cmd
    
    - name: Upload package
      uses: actions/upload-artifact@v4
      with:
        name: NCG-Remote-Package
        path: NCG-Remote-Portable.zip

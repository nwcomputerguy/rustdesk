name: NCG Remote Package

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  create-package:
    runs-on: windows-latest
    
    steps:
    - name: Download and Package
      shell: powershell
      run: |
        # Download official RustDesk
        Write-Host "Downloading RustDesk 1.4.0..."
        Invoke-WebRequest -Uri "https://github.com/rustdesk/rustdesk/releases/download/1.4.0/rustdesk-1.4.0-x86_64.exe" -OutFile "rustdesk.exe"
        
        # Create package directory
        New-Item -ItemType Directory -Force -Path "NCG-Remote"
        Move-Item "rustdesk.exe" "NCG-Remote\NCG-Remote-Access.exe"
        
        # Create config file
        @"
rendezvous_server = 'rust.northwoodscomputerguy.com:21116'
nat_type = 1
serial = 0

[options]
custom-rendezvous-server = 'rust.northwoodscomputerguy.com:21116'
key = 'sjVK2P8Cik7MW4v6sn1FhCN5RdRAK1BpqXlSDraF0qY='
relay-server = 'rust.northwoodscomputerguy.com:21117'
api-server = ''
"@ | Out-File -FilePath "NCG-Remote\RustDesk2.toml" -Encoding UTF8
        
        # Create launcher
        @"
@echo off
color 0A
echo NCG Remote Access v1.4.0
echo ========================
echo.
start "" NCG-Remote-Access.exe
echo Your ID will appear in the app window.
echo Server: rust.northwoodscomputerguy.com
echo.
pause
"@ | Out-File -FilePath "NCG-Remote\Start-NCG-Remote.bat" -Encoding ASCII
        
        # Create README
        @"
NCG Remote Access
=================
Version: 1.4.0
Server: rust.northwoodscomputerguy.com

Quick Start:
1. Run Start-NCG-Remote.bat
2. Share your ID with support
"@ | Out-File -FilePath "NCG-Remote\README.txt" -Encoding UTF8
        
        # Create ZIP
        Compress-Archive -Path "NCG-Remote\*" -DestinationPath "NCG-Remote.zip" -Force
        
        # Show package contents
        Write-Host "`nPackage created successfully!"
        Get-ChildItem "NCG-Remote" | Format-Table Name, Length
    
    - name: Upload Package
      uses: actions/upload-artifact@v4
      with:
        name: NCG-Remote
        path: NCG-Remote.zip
    
    - name: Release
      uses: softprops/action-gh-release@v2
      if: startsWith(github.ref, 'refs/tags/')
      with:
        files: NCG-Remote.zip
